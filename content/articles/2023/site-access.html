<head>
  <title>Adding Content to This Site</title>
  <meta name="keywords" content="uplload" />
  <meta name="date" content="2023-12-05 10:21" />
  <meta name="category" content="misc" />
</head>
<body>
  <p>
    I don't add content to this site very often. I should. Part of
    the reason for that is I don't actually rememember <i>how</i>
    to get content to appear here.
  </p>
  <p>
    When I first setup this system up, I had it so that any content
    I checked into <a href="https://github.com/mankyd/othm/">github</a>
    would automatically regenerate the site and upload here. At some
    point that system stopped working, and my knowledge of how it
    was all setup atrophied.
  </p>
  <p>
    I am going to attempt to document my progress of getting it
    working again here. I'll hopefully be able to use this docunent
    as a reference in the future.
  </p>
  <h1>2023-12-05 10:26</h1>
  <p>
    First to specify what I know:
    <ul>
      <li>
        The content is hosted in github at 
        <a href="https://github.com/mankyd/othm/">https://github.com/mankyd/othm/</a>
      </li>
      <li>
        This site, I believe, is hosted on Google Cloud. I can access this by
        visiting
        <a href="https://console.cloud.google.com/">https://console.cloud.google.com/</a>.
      </li>
      <li>
        The "project" is called "Oh the Huge Manatee", has a 
        "Project number" of "448264688868", and a "Project ID" of "gce-othm".
      </li>
    </ul>
  </p>
  <p>
    Initial clicking around appears to suggest usage of the 
    "Compute Engine API".
  </p>
  <h1>2023-12-05 10:41</h1>
  <p>
    I clicked around a bunch and came up empty. Then I remembered that it might
    actually be based on <a href="https://console.firebase.google.com/">Firebase</a>
    instead of Google Cloud directly. Clicking through to the console seems to
    confirm this.
  </p>
  <p>
    I am going to pause here for awhile. I think I need a personal computer with
    command line access to continue.
  </p>
  <h1>2025-02-12 20:17</h1>
  <p>
    Whew, it's been awhile!
  </p>
  <p>
    The next thing to try was downloading a copy of the site locally. I have a new
    (to me) OSX laptop. I ran "git" but it was not installed. OSX prompted me to
    install it automatically, and I did.
  </p>
  <p>
    I had to setup an SSH key to actually work on the code. I could have cloned the
    repository with out it, but I won't be able to push. I started with GitHub's
    <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">
    instructions for adding an ssh key to an account.</a> This, of course, meant
    generating an ssh key first. Thankfully, github has 
    <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">
    an article for that</a> as well.
  </p>
  <code>
    ssh-keygen -t ed25519 -C "your_email@example.com"
  </code>
  <p>
    Followed by
  </p>
  <code>
    eval "$(ssh-agent -s)"
  </code>
  <p>
    Then adding the following to ~/.ssh/config
  </p>
  <code>
    Host github.com
      AddKeysToAgent yes
      UseKeychain yes  # omit line if not using a passphrase
      IdentityFile ~/.ssh/id_ed25519
  </code>
  <p>
    Then
  </p>
  <code>
    ssh-add --apple-use-keychain ~/.ssh/id_ed25519
  </code>
  <p>
    And lastly
  </p>
  <code>
    pbcopy < ~/.ssh/id_ed25519.pub
  </code>
  <p>
    This last command copied the public key to my clipboard. 
    I could then paste it into the
    <a href="https://github.com/settings/ssh/new">new ssh key</a>
    page and save it.
  </p>
  <p>WHEW!</p>
  <p>
    I cloned the repository locally, where I am editing it now.
  </p>
  <p>
    The next step was getting python up and working. This blog is
    generated by <a href="https://getpelican.com/">Pelican</a>.
    I am actually a little terrified that new versions of Pelican
    may actually not be backwards compatible, but one thing at a time!
  </p>
  <p>
    Python does not come installed on OSX by default. Some quick
    googling suggested that <a href="https://brew.sh/">Homebrew</a>
    was the best way to install and manage Python these days. I copied
    and pasted the install command at the top of the page:
  </p>
  <code>
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  </code>
  <p>
    Always a little terrifying to curl random bash scripts, but I suppose
    it's no worse than downloading and running any other random, uninspected
    binary.
  </p>
  <p>
    Next was "brew install python". This installed Python 3.13.2. It did
    not, however, add "python" to the path, only "python3". Documentation
    I found suggested adding 
  </p>
  <code>
    export PATH="/usr/local/opt/python/libexec/bin:$PATH"
  </code>
  <p>
    to my "~/.profile" file, but this didn't work. OSX runs zsh by
    default, so I needed to add it to "~/.zprofile".
  </p>
  <p>
    Next to setup a virtual environment to run pelican in.
  </p>
  <code>
    pip install --user pipenv
  </code>
  <p>
    Homebrew intercepted me here and told me it was an error to do so.
    Instead, it suggested
  </p>
  <code>
    python3 -m venv path/to/venv
  </code>
  <h1>2025-02-12 20:51</h1>
  <p>
    I ran "python3 -m venv ." in my repository but this seems to have
    been a mistake. It edited my ".gitignore" file to ignore 
    everything. I restored ".gitignore" and saw that it had had added
    several files and directories to the repository. Time to try
    something different.
  </p>
  <p>
    I made a new directory, which will server as my vitual environent,
    and moved my repository in as a subdirectory. I then reran the
    venv command, and everything seems happier now. I ran
  </p>
  <code>
    . bin/activate
  </code>
  <p>
    to enter my vitual environment.
  </p>
  <p>
    Pelican suggests installing it with
  </p>
  <code>
    python -m pip install "pelican[markdown]"
  </code>
  <p>
    pip then informed me that I should upgrade it, so I did.
  </p>
  <p>
    Pelican says to run
  </p>
  <code>
    pelican -r -l
  </code>
  <p>
    So I changed to my repositories subdirectory, ran it, and was
    met with a bunch of errors.
  </p>
  <blockquote>
    [21:03:45] WARNING  Feeds generated without SITEURL set properly may not be valid                                                                                  settings.py:679
           WARNING  No timezone information specified in the settings. Assuming your timezone is UTC for feed generation. Check                                    settings.py:684
                    https://docs.getpelican.com/en/latest/settings.html#TIMEZONE for more information                                                                             
  --- AutoReload Mode: Monitoring `content`, `theme` and `settings` for changes. ---
Feeds generated without SITEURL set properly may not be valid
No timezone information specified in the settings. Assuming your timezone is UTC for feed generation. Check https://docs.getpelican.com/en/latest/settings.html#TIMEZONE for more information
Process Process-1:
Traceback (most recent call last):
  File "/usr/local/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "/usr/local/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/dave/devel/othm/lib/python3.13/site-packages/pelican/__init__.py", line 572, in autoreload
    settings_file = os.path.abspath(args.settings)
  File "<frozen posixpath>", line 378, in abspath
TypeError: expected str, bytes or os.PathLike object, not NoneType
Serving site at: http://127.0.0.1:8000 - Tap CTRL-C to stop
  </blockquote>
  <p>
    The SITEURL and timezone matters I can fix. I am currently unsure
    about the stacktrace however. Visiting the site as it suggests also
    fails.
  </p>
  <h1>2025-02-15 09:22</h1>
  <p>
    Back to it, the reason for the above errors is the version of Pelican this
    site was originally compiled with (2? 3?) ran on Python 2, while Pelican 4
    only supports Python 3. I have a choice: install Python 2, and then install
    an old version of Pelican, or just upgrade this site.
  </p>
  <p>
    Time to upgrade this site!
  </p>
  <p>
    First, I created a new Pelican site alongside the existing one, just to see
    what's changed. After creating a new emptry directory, I run 
    "pelican-quickstart" per the instructions, but the command doesn't work. I
    see the the command exists in my virtual environment's "bin" directory, but
    that bin is not in my path. I run "../bin/pelican-quickstart" instead.
  </p>
  <p>
    I followed the on screen prompts with mostly default or obvious values. 
    When I got to the timezone option, it defaulted to "Europe/Rome", which is
    not correct, so I started googling around for the appropriate string
    (something related to us eastern timezone). The first Wikipedia article
    on the <a href="https://en.wikipedia.org/wiki/Eastern_Time_Zone">Eastern
    Time Zone</a> does not appear to contain a magic string that looks correctly
    formatted. I am pretty sure I am looking for something like "New York/US" 
    or similar. Next I found <a href="https://time.is/ET">Time.is</a> which 
    contains a bunch of "IANA time zone identifiers" which look correct. I
    selected "America/New_York". After a few more questions where I selected
    the defaults, my new site was setup.
  </p>
  <code>
    pelican content
    pelican --listen
  </code>
  <p>
    With those two commands, I had a working, if bare, Pelican site. I stopped
    the pelican process.
  </p>
  <p>
    I copied over the "content" directory of this existing site into the 
    content directory of this temporary site and ran "pelican -l -r". I was
    greeted by many errors, including an apparent infinite loop:
  </p>
  <blockquote>
Skipping /Users/dave/devel/othm/tmp/content/word-o-matic/index.html: could not find information about 'date'
There are 2 items "with slug "2016-in-review"" with lang en: 
/Users/dave/devel/othm/tmp/content/articles/2016/2016_in_review.html
/Users/dave/devel/othm/tmp/content/articles/2022/butterfly.html
There are 2 original (not translated) items with slug "2016-in-review": 
/Users/dave/devel/othm/tmp/content/articles/2016/2016_in_review.html
/Users/dave/devel/othm/tmp/content/articles/2022/butterfly.html
{filename} used for linking to static content /images/2016/parachute-skydiving-parachuting-jumping-38447.jpeg in articles/2016/double_blind_parachute_trial.html. Use {static} instead
Caught exception:
"File /Users/dave/devel/othm/tmp/output/2016-in-review.html is to be overwritten".
Skipping /Users/dave/devel/othm/tmp/content/word-o-matic/index.html: could not find information about 'date'
Skipping /Users/dave/devel/othm/tmp/content/word-o-matic/index.html: could not find information about 'date'
Skipping /Users/dave/devel/othm/tmp/content/word-o-matic/index.html: could not find information about 'date'
Skipping /Users/dave/devel/othm/tmp/content/word-o-matic/index.html: could not find information about 'date'
Skipping /Users/dave/devel/othm/tmp/content/word-o-matic/index.html: could not find information about 'date'
...
  </blockquote>
  <p>
    First, I fixed the metadata in butterfly.html, changing the title, keywords, 
    and date. Then I added the time to the the_magical_wordomatic.html, hoping 
    that would resolve the loop. I reran "pelican content" and it appears to have
    worked, outside of a few deprecation warnings. I then ran "pelican -l -r"
    again and it appeared to be working site.
  </p>
  <p>
    Then I looked over some of the earlier output and realized that I still
    have an error in the_magical_wordomatic.html page:
  </p>
  <blockquote>
    ERROR    Skipping /Users/dave/devel/othm/tmp/content/word-o-matic/index.html: could not find information about 'date' 
  </blockquote>
  <p>
    <i>Then</i>I looked closer and realized that all my articles are actually in 
    "content/articles" and that it is trying to parse what it supposed to be a
    static page.
  </p>
  <p>
    The documentation says that setting "STATIC_PATHS" in "pelicanconf.py"
    should be enough to fix it. I copied over the values from the old version
    of the site, but the error persisted. After a bit of playing around and
    making no progress, I decided to move on. Maybe this was happening because
    my output structure was flat, instead of nested directories as it is
    currently?
  </p>
  <h1>2025-02-15 11:38</h1>
  <p>
    I copied and pasted over the ARTICLE_SAVE_AS and ARTICLE_URL
    values from the previous site. This seems to have organize things, but
    still no luck on the word-o-matic.
  </p>
  <p>
    Finally, I changed "ARTICLE_PATHS" from its default value to 
    "['articles']" and this seems to have resolved the issue.
  </p>
  <p>
    I copied over the "theme" directory next, and blindly set the
    "THEME" property to "theme/othm" as I had in the prioer version and was
    met with a new error: "Encountered unknown tag 'assets'.". Some plugin I
    am missing perhaps? I copied over the "plugins" and "pelicanplugins"
    directories, added them to the pelicanconf.py file and...
  </p>
  <blockquote>
[11:53:21] ERROR    Cannot load plugin `assets`                                                                                                                                              
                    Cannot import plugin `assets`                                                                                                                                                           
           ERROR    Cannot load plugin `gzip_cache`                                                                                                                                          
                    Cannot import plugin `gzip_cache`                                                                                                                                                       
           ERROR    Cannot load plugin `htmlminify`                                                                                                                                           
                    No module named 'htmlmin'                                                                                                                                                               
           ERROR    Cannot load plugin `optimize_images`                                                                                                                                      
                    Cannot import plugin `optimize_images`                                                                                                                                                  
           ERROR    Cannot load plugin `summary`                                                                                                                                              
                    Cannot import plugin `summary`                                                                                                                                                          
           ERROR    Cannot load plugin `tag_cloud`                                                                                                                                         
                    Cannot import plugin `tag_cloud`                                                                                                                                                        
  --- AutoReload Mode: Monitoring `content`, `theme` and `settings` for changes. ---
Cannot load plugin `assets`
Cannot import plugin `assets`
Cannot load plugin `gzip_cache`
Cannot import plugin `gzip_cache`
Cannot load plugin `htmlminify`
No module named 'htmlmin'
Cannot load plugin `optimize_images`
Cannot import plugin `optimize_images`
Cannot load plugin `summary`
Cannot import plugin `summary`
Cannot load plugin `tag_cloud`
Cannot import plugin `tag_cloud`
Serving site at: http://127.0.0.1:8000 - Tap CTRL-C to stop
Caught exception:
"Encountered unknown tag 'assets'.".
  </blockquote>
  <p>
    I cloned the old
    <a href="https://github.com/getpelican/pelican-plugins">pelican-plugins</a> 
    which is evidently deprecated in favor of the newer
    <a href="https://github.com/pelican-plugins">pelican-plugins github org</a>.
    I'll sort that all out later. 
  </p>
  <p>
    Still, a few plugins were broken: htmlmin, summary, and assets. I disabled
    the htmlmin plugin. Summary asked for the "bs4" package to be installed,
    which I did. Assets needed the "webassets" package.
  </p>
  <p>
    Now running "pelican content" almost works, save for a new error about
    "cssmin" not being installed. After installing that, things maybe worked, 
    except now I get an error agout "jpegtran" and "optipng" not being installed,
    although the content says it generated succesfully. Loading the site
    in a browser now sort of works, though css appears incorrect. Viewing the
    network traffic does not show any 404 errors. Maybe I inlined the css?
  </p>
  <h1>2023-12-05 17:29:00</h1>
  <p>
    Looking at the source for the output site, I indeed saw an empty style
    tag at the top. The theme is expecting some sort of "ASSET_CONTENTS"
    variable to be populated, but I can't see this documented anywhere in
    the asset's plugin documentation.
  </p>
  <p>
    Instead of inlining the content, I uncommented a link tag I had at the
    top and that seems have to restored things. I think I am getting close!
  </p>
  <p>
    Clicking on tag on the side brings me to a different (though functional)
    url than is live on the site today. I scanned through the difference
    in the settings file and found that TAG_URL and PAGE_URL were set on the
    prior version of the site, so I copied those over. Things seems very
    similar now!
  </p>
  <p>
    There are only two obvious differences: First, the dates are displaying
    differently on the articles, but I am ok with that. I will probalby
    change it to something different in the future. Second, the new site has
    the front page paginated. I have wanted to do this for awhile, but not
    as it is currently implemented. Setting "DEFAULT_PAGINATION" to false
    fixes this up.
  </p>
  <p>
    Ok, so I had a newly generated site. I copied it over the old content,
    ran git diff, saw nominal differences, and commited.
  </p>
  <p>
    But now I still need to push to the server.
  </p>
  
</body>
